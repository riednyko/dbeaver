<?xml version="1.0" encoding="UTF-8"?>
<?eclipse version="3.4"?>
<!--
 * DBeaver - Universal Database Manager
 * Copyright (C) 2010-2018 Serge Rider (serge@jkiss.org)
 * Copyright (C) 2017-2018 Alexander Fedorov (alexander.fedorov@jkiss.org)
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
  -->
<plugin>

    <extension-point id="org.jkiss.dbeaver.debug.ui.configurationPanels" name="DBeaver debug configuration panels" schema="schema/org.jkiss.dbeaver.debug.configurationPanels.exsd"/>

    <extension point="org.eclipse.debug.ui.launchConfigurationTypeImages">
        <launchConfigurationTypeImage
                id="org.jkiss.dbeaver.debug.launchConfigurationTypeImage"
                configTypeID="org.jkiss.dbeaver.debug.launchConfiguration"
                icon="platform:/plugin/org.jkiss.dbeaver.core/$nl$/icons/database.png">
        </launchConfigurationTypeImage>
    </extension>

    <extension point="org.eclipse.debug.ui.launchConfigurationTabGroups">
        <launchConfigurationTabGroup
                id="org.jkiss.dbeaver.debug.launchConfigurationTabGroup"
                class="org.jkiss.dbeaver.debug.ui.DatabaseDebugConfigurationTabGroup"
                description="%launchConfigurationTabGroup.description"
                type="org.jkiss.dbeaver.debug.launchConfiguration">
            <launchMode mode="debug" description="%launchConfigurationTabGroup.launchMode.description" perspective="org.jkiss.dbeaver.core.perspective"/>
        </launchConfigurationTabGroup>
    </extension>

    <extension point="org.eclipse.debug.ui.launchGroups">
        <launchGroup
                bannerImage="platform:/plugin/org.jkiss.dbeaver.core/$nl$/icons/database.png"
                id="org.jkiss.dbeaver.debug.launchGroup"
                image="platform:/plugin/org.jkiss.dbeaver.core/$nl$/icons/database.png"
                label="%launchGroups.launchGroup.label"
                mode="debug"
                title="%launchGroups.launchGroup.title">
        </launchGroup>
    </extension>

    <extension point="org.eclipse.debug.ui.launchShortcuts">
        <shortcut
                id="org.jkiss.dbeaver.debug.ui.shortcut"
                label="%launchShortcuts.shortcut.label"
                description="%launchShortcuts.shortcut.description"
                class="org.jkiss.dbeaver.debug.ui.internal.DatabaseDebugLaunchShortcut"
                icon="platform:/plugin/org.jkiss.dbeaver.core/$nl$/icons/database.png"
                modes="debug">
            <configurationType id="org.jkiss.dbeaver.debug.ui.configuration"/>
            <contextualLaunch>
                <contextLabel label="%launchShortcuts.shortcut.label" mode="debug">
                </contextLabel>
                <enablement>
                    <with variable="selection">
                        <count value="1"/>
                        <iterate ifEmpty="false" operator="and">
                            <adapt type="org.jkiss.dbeaver.debug.DBGDebugObject"/>
                        </iterate>
                    </with>
                </enablement>
            </contextualLaunch>
        </shortcut>
    </extension>

    <extension point="org.eclipse.core.runtime.adapters">
        <factory adaptableType="org.jkiss.dbeaver.ui.editors.entity.EntityEditor"
                 class="org.jkiss.dbeaver.debug.ui.actions.DebugActionAdapterFactory">
            <adapter type="org.eclipse.debug.ui.actions.IToggleBreakpointsTarget"/>
        </factory>
        <factory adaptableType="org.jkiss.dbeaver.ui.editors.entity.EntityEditorInput"
                 class="org.jkiss.dbeaver.debug.ui.actions.DebugActionAdapterFactory">
            <adapter type="org.eclipse.debug.ui.actions.ILaunchable"/>
        </factory>
        <factory adaptableType="org.jkiss.dbeaver.model.navigator.DBNDatabaseObject"
                 class="org.jkiss.dbeaver.debug.ui.actions.DebugActionAdapterFactory">
            <adapter type="org.eclipse.debug.ui.actions.ILaunchable"/>
        </factory>
    </extension>

    <extension point="org.eclipse.debug.ui.debugModelPresentations">
        <debugModelPresentation class="org.jkiss.dbeaver.debug.ui.DatabaseDebugModelPresentation"
                                id="org.jkiss.dbeaver.debug.core.database"/>
    </extension>

    <extension point="org.eclipse.debug.ui.detailPaneFactories">
        <detailFactories
                class="org.jkiss.dbeaver.debug.ui.details.DatabaseDetailPaneFactory"
                id="org.jkiss.dbeaver.debug.ui.detailPaneFactories.detailFactories.database">
            <enablement>
                <with variable="selection">
                    <count value="1"/>
                    <iterate operator="or">
                        <instanceof value="org.jkiss.dbeaver.debug.core.breakpoints.IDatabaseBreakpoint"/>
                    </iterate>
                    <iterate operator="or"/>
                </with>
            </enablement>
        </detailFactories>
    </extension>

    <extension point="org.eclipse.ui.handlers">
        <handler commandId="org.eclipse.debug.ui.commands.ToggleBreakpoint" class="org.jkiss.dbeaver.debug.ui.actions.ToggleBreakpointHandler"/>
    </extension>

    <extension point="org.eclipse.ui.menus">
        <menuContribution allPopups="false" locationURI="popup:#SQLRulerContext?before=additions">
            <command commandId="org.eclipse.debug.ui.commands.ToggleBreakpoint" label="%command.ToggleBreakpoint.label" style="push"/>
        </menuContribution>
    </extension>

    <extension point="org.eclipse.ui.commands">
        <category description="Database Debug commands" id="org.jkiss.dbeaver.debug.ui.commands.category" name="Database Debug"/>

        <command
                name="%commands.command.menuDelegateToolbar.name"
                description="%commands.command.menuDelegateToolbar.description"
                categoryId="org.jkiss.dbeaver.debug.ui.commands.category"
                id="org.jkiss.dbeaver.debug.ui.commands.command.menuDelegateToolbar">
        </command>
        <command
                name="%commands.command.debugConfigurations.name"
                categoryId="org.jkiss.dbeaver.debug.ui.commands.category"
                description="%commands.command.debugConfigurations.description"
                id="org.jkiss.dbeaver.debug.ui.commands.command.debugConfigurations">
        </command>
    </extension>

    <extension point="org.eclipse.ui.actionSets">
        <actionSet label="%actionSets.actionSet.label" visible="true" id="org.jkiss.dbeaver.debug.actionSet">
            <!-- Do we need an entry in main menu? I guess not -->
            <!--
            <menu label="%actionSets.actionSet.menu.debug.label" path="additions" id="org.eclipse.ui.debug">
                <separator name="org.jkiss.dbeaver.debug.group"/>
            </menu>
            <action
                    label="%actionSets.action.menu.label"
                    style="pulldown"
                    icon="platform:/plugin/org.eclipse.debug.ui/$nl$/icons/full/obj16/ldebug_obj.png"
                    class="org.jkiss.dbeaver.debug.ui.internal.DebugMenuDelegate"
                    menubarPath="org.eclipse.ui.debug/org.jkiss.dbeaver.debug.group"
                    id="org.jkiss.dbeaver.debug.ui.actionSets.action.menuAction">
            </action>
            -->
            <action
                    definitionId="org.jkiss.dbeaver.debug.ui.commands.command.menuDelegateToolbar"
                    label="%actionSets.action.toolbar.label"
                    style="pulldown"
                    icon="platform:/plugin/org.eclipse.debug.ui/$nl$/icons/full/obj16/ldebug_obj.png"
                    tooltip="%actionSets.action.toolbar.tooltip"
                    class="org.jkiss.dbeaver.debug.ui.internal.DebugMenuDelegate"
                    toolbarPath="org.eclipse.debug.ui.launchActionSet/debug"
                    id="org.jkiss.dbeaver.debug.ui.actionSets.action.debugToolbar">
            </action>

            <action
                    definitionId="org.jkiss.dbeaver.debug.ui.commands.command.debugConfigurations"
                    label="%actionSets.action.debugConfigurations.label"
                    class="org.jkiss.dbeaver.debug.ui.internal.DebugLaunchDialogAction"
                    id="org.jkiss.dbeaver.debug.ui.actionSets.action.debugConfigurations">
            </action>
        </actionSet>
    </extension>

</plugin>
